# Authors: Iain Richey
# Description: Tests the analysis model
from FhirCapstoneProject.fhirtypepkg.analysis import predict
import pytest
from json import loads
from deepdiff import DeepDiff

def test_analysis_model():
    testMich = [
    {
        "Endpoint": "Humana",
        "DateRetrieved": "2024-02-29T04:47:16Z",
        "FullName": "Dykstra, Michelle L",
        "NPI": 1013072586,
        "FirstName": "Michelle",
        "LastName": "Dykstra",
        "Gender": "Female",
        "LastPracUpdate": "2023-08-06T08:26:02Z",
        "GroupName": None,
        "Taxonomy": None,
        "LastPracRoleUpdate": "2023-08-05T08:53:45Z",
        "ADD1": "610 Jefferson St",
        "ADD2": "Optional",
        "City": "Oregon City",
        "State": "OR",
        "Zip": "97045",
        "Phone": 5036577235,
        "Fax": None,
        "Email": None,
        "lat": None,
        "lng": None,
        "LastLocationUpdate": "2023-08-06T08:12:10Z"
    },
    {
        "Endpoint": "Humana",
        "DateRetrieved": "2024-02-29T04:47:16Z",
        "FullName": "Dykstra, Michelle L",
        "NPI": 1013072586,
        "FirstName": "Michelle",
        "LastName": "Dykstra",
        "Gender": "Female",
        "LastPracUpdate": "2023-08-06T08:26:02Z",
        "GroupName": None,
        "Taxonomy": None,
        "LastPracRoleUpdate": "2023-08-05T10:16:17Z",
        "ADD1": "610 Jefferson St",
        "ADD2": "Optional",
        "City": "Oregon City",
        "State": "OR",
        "Zip": "97045",
        "Phone": 5036577235,
        "Fax": None,
        "Email": None,
        "lat": None,
        "lng": None,
        "LastLocationUpdate": "2023-08-06T08:12:10Z"
    },
    {
        "Endpoint": "Humana",
        "DateRetrieved": "2024-02-29T04:47:16Z",
        "FullName": "Dykstra, Michelle L",
        "NPI": 1013072586,
        "FirstName": "Michelle",
        "LastName": "Dykstra",
        "Gender": "Female",
        "LastPracUpdate": "2023-08-06T08:26:02Z",
        "GroupName": None,
        "Taxonomy": None,
        "LastPracRoleUpdate": "2023-08-05T12:07:47Z",
        "ADD1": "610 Jefferson St",
        "ADD2": "Optional",
        "City": "Oregon City",
        "State": "OR",
        "Zip": "97045",
        "Phone": 5036577235,
        "Fax": None,
        "Email": None,
        "lat": None,
        "lng": None,
        "LastLocationUpdate": "2023-08-06T08:12:10Z"
    },
    {
        "Endpoint": "Humana",
        "DateRetrieved": "2024-02-29T04:47:16Z",
        "FullName": "Dykstra, Michelle L",
        "NPI": 1013072586,
        "FirstName": "Michelle",
        "LastName": "Dykstra",
        "Gender": "Female",
        "LastPracUpdate": "2023-08-06T08:26:02Z",
        "GroupName": None,
        "Taxonomy": None,
        "LastPracRoleUpdate": "2023-08-05T17:30:40Z",
        "ADD1": "610 Jefferson St",
        "ADD2": "Optional",
        "City": "Oregon City",
        "State": "OR",
        "Zip": "97045",
        "Phone": 5036577235,
        "Fax": None,
        "Email": None,
        "lat": None,
        "lng": None,
        "LastLocationUpdate": "2023-08-06T08:12:10Z"
    },
    {
        "Endpoint": "Humana",
        "DateRetrieved": "2024-02-29T04:47:16Z",
        "FullName": "Dykstra, Michelle L",
        "NPI": 1013072586,
        "FirstName": "Michelle",
        "LastName": "Dykstra",
        "Gender": "Female",
        "LastPracUpdate": "2023-08-06T08:26:02Z",
        "GroupName": None,
        "Taxonomy": None,
        "LastPracRoleUpdate": "2023-08-05T05:31:10Z",
        "ADD1": "610 Jefferson St",
        "ADD2": "Optional",
        "City": "Oregon City",
        "State": "OR",
        "Zip": "97045",
        "Phone": 5036577235,
        "Fax": None,
        "Email": None,
        "lat": None,
        "lng": None,
        "LastLocationUpdate": "2023-08-06T08:12:10Z"
    },
    {
        "Endpoint": "Kaiser",
        "DateRetrieved": "2024-02-29T04:47:22Z",
        "FullName": "Dykstra, Michelle L",
        "NPI": 1013072586,
        "FirstName": "Michelle",
        "LastName": "Dykstra",
        "Gender": "Female",
        "LastPracUpdate": "2024-01-05T01:44:29-08:00",
        "GroupName": "Willamette Valley Family Center, LLC",
        "Taxonomy": None,
        "LastPracRoleUpdate": "2024-01-05T02:15:54-08:00",
        "ADD1": "610 Jefferson St",
        "ADD2": "Optional",
        "City": "Oregon City",
        "State": "OR",
        "Zip": "97045-2329",
        "Phone": 8556328280,
        "Fax": 5036577676,
        "Email": None,
        "lat": 45.354828,
        "lng": -122.604025,
        "LastLocationUpdate": "2024-01-05T01:09:58-08:00"
    },
    {
        "Endpoint": "PacificSource",
        "DateRetrieved": "2024-02-29T04:47:24Z",
        "FullName": "Dykstra, Michelle",
        "NPI": 1013072586,
        "FirstName": "Michelle",
        "LastName": "Dykstra",
        "Gender": "Female",
        "LastPracUpdate": "2023-09-12T21:36:49-07:00",
        "GroupName": "Unknown",
        "Taxonomy": None,
        "LastPracRoleUpdate": "2023-09-12T21:38:36-07:00",
        "ADD1": "610 Jefferson St",
        "ADD2": "Optional",
        "City": "Oregon City",
        "State": "OR",
        "Zip": "97045",
        "Phone": 5036577235,
        "Fax": None,
        "Email": None,
        "lat": None,
        "lng": None,
        "LastLocationUpdate": "2023-09-12T21:38:36-07:00"
    }
    ]

    output = {
        'Endpoint': 'Concensus', 
        'DateRetrieved': '2024-02-29T04:47:16Z', 
        'Accuracy': 1, 
        'FullName': 'Dykstra, Michelle L', 
        'NPI': 1013072586, 
        'FirstName': 'Michelle', 
        'LastName': 'Dykstra', 
        'Gender': 'Female', 
        'LastPracUpdate': '2023-08-06T08:26:02Z', 
        'GroupName': None, 
        'Taxonomy': None, 
        'LastPracRoleUpdate': '2023-08-05T08:53:45Z', 
        'ADD1': '610 Jefferson St', 
        'ADD2': 'Optional', 
        'City': 'Oregon City', 
        'State': 'OR', 
        'Zip': '97045', 
        'Phone': 5036577235, 
        'Fax': None, 
        'Email': None, 
        'lat': None, 
        'lng': None, 
        'LastLocationUpdate': '2023-08-06T08:12:10Z'}


    consensus = predict(testMich)

    print(consensus)
    print(output)

    diff = DeepDiff(consensus, output)

    assert not diff